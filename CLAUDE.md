# CLAUDE.md - Budget Level v2

## å°ˆæ¡ˆæ¦‚è¿°

**Budget Levelï¼ˆé ç®—æ°´ä½ï¼‰** æ˜¯ä¸€å€‹å¿ƒç†å¸³æˆ¶ç®¡ç†ç³»çµ±ï¼ŒæŽ¡ç”¨ã€Œä¿¡å°è¢‹ç†è²¡æ³•ã€çš„æ¦‚å¿µï¼šæ‰€æœ‰æ”¶å…¥éƒ½è¦è²¼æ¨™ç±¤ï¼Œæ‰€æœ‰æ”¯å‡ºéƒ½æ˜¯åœ¨æ¶ˆè€—æ¨™ç±¤å…§çš„é¡åº¦ã€‚

**æ ¸å¿ƒåƒ¹å€¼ï¼š**
- æ°´ä½è¦–è¦ºåŒ– â€” å³æ™‚å‘ˆç¾ç”Ÿæ´»é ç®—é¤˜é¡èˆ‡æ¶ˆè€—é€Ÿåº¦
- AI-Ready Data â€” ç”¢å‡ºçµæ§‹åŒ–è³‡æ–™ï¼Œä¾¿æ–¼åŒ¯å‡ºçµ¦ LLM é€²è¡Œè²¡å‹™åˆ†æž

**é€™ä¸æ˜¯è¨˜å¸³è»Ÿé«”ï¼Œè€Œæ˜¯å¿ƒç†å¸³æˆ¶ç®¡ç†ç³»çµ±ã€‚**

---

## æŠ€è¡“æž¶æ§‹

| é …ç›® | æŠ€è¡“ |
|------|------|
| å‰ç«¯æ¡†æž¶ | Streamlit (â‰¥1.35.0) |
| è³‡æ–™åº« | Google Sheets |
| é€£ç·šå¥—ä»¶ | gspread + google-auth |
| èªžè¨€ | Python 3.10+ |
| éƒ¨ç½² | Streamlit Cloud |

**é—œéµç‰ˆæœ¬è¦æ±‚ï¼š**
- `st.dialog` éœ€è¦ Streamlit 1.35+
- `st.popover` éœ€è¦ Streamlit 1.34+

---

## æ ¸å¿ƒæ¦‚å¿µ

### äº”å€‹å¿ƒç†å¸³æˆ¶

| å¸³æˆ¶ | å¿ƒç†æ„ç¾© | æ€§è³ª |
|------|----------|------|
| **Living** | ã€Œæˆ‘èƒ½èŠ±çš„éŒ¢ã€ | æ—¥å¸¸é«˜é »æ¶ˆè²»ï¼Œæœ‰é ç®—ä¸Šé™ |
| **Saving** | ã€Œå°ˆæ¬¾å°ˆç”¨çš„éŒ¢ã€ | ç›®æ¨™å°Žå‘ï¼ˆå¤§å°ç›®æ¨™çš†å¯ï¼‰ |
| **Investing** | ã€Œè®“éŒ¢é•·å¤§çš„éŒ¢ã€ | ç´€å¾‹å°Žå‘ï¼Œåªè¿½è¹¤æ’¥æ¬¾ |
| **Back Up** | ã€Œæˆ‘çš„è¡€é‡ã€ | ç·©è¡å®‰å…¨å¢Šï¼ŒLiving è¶…æ”¯æ‰£é€™è£¡ |
| **Free Fund** | ã€Œç†è²¡çš„å¾—åˆ†ã€ | çŽå‹µæ± ï¼Œçµé¤˜å’Œå·®é¡é€²é€™è£¡ |

### Living vs Saving çš„é‚Šç•Œ

- **Living**ï¼šé«˜é »ã€ä¸ç‰¹å®šã€æ¯å¤©éƒ½æœƒèŠ±ï¼ˆé£²é£Ÿã€äº¤é€šã€æ—¥ç”¨å“ï¼‰
- **Saving**ï¼šæœ‰æ˜Žç¢ºç›®æ¨™ã€å°ˆæ¬¾å°ˆç”¨ï¼ˆå­¸è²»ã€æ—…éŠã€è²·éŠæˆ²æ©Ÿã€çœ‹é›»å½±ï¼‰

**åŽŸå‰‡ï¼š** åªæœ‰çœŸæ­£ã€Œæ¯å¤©æœƒèŠ±ã€éœ€è¦æŽ§åˆ¶ç¯€å¥ã€çš„æ¶ˆè²»æ‰æ”¾ Livingï¼Œå…¶ä»–éƒ½ç”¨ Saving ç›®æ¨™ç®¡ç†ã€‚

### ç™¼è–ªé€±æœŸ

æ‰€æœ‰é ç®—å’Œçµç®—éƒ½ä»¥ç™¼è–ªé€±æœŸç‚ºæº–ï¼Œä¸æ˜¯æ—¥æ›†æœˆã€‚

```
ç™¼è–ªé€±æœŸ = ç™¼è–ªæ—¥ ~ ä¸‹å€‹ç™¼è–ªæ—¥å‰ä¸€å¤©
ç¯„ä¾‹ï¼šç™¼è–ªæ—¥ = æ¯æœˆ 5 è™Ÿ â†’ æœ¬æœŸï¼š1/5 ~ 2/4
```

### çµç®—æ©Ÿåˆ¶

- **åªæœ‰æœˆçµç®—**ï¼Œå°æº–ç™¼è–ªé€±æœŸ
- **è¢«å‹•è§¸ç™¼ + ä½¿ç”¨è€…ç¢ºèª**
- çµé¤˜ > 0 â†’ é€² Free Fund
- è¶…æ”¯ < 0 â†’ æ‰£ Back Up

### è³‡é‡‘æµå‹•

```
æ”¶å…¥ â†’ æœˆåˆæ¡†å®š â†’ Living / Saving / Investing / Back Up / Free Fund

Living è¶…æ”¯ â†’ æ‰£ Back Up
Living çµé¤˜ â†’ é€² Free Fund
Saving å®Œæˆå·®é¡ â†’ é€² Free Fund
Free Fund â†’ å¯è½‰åˆ°ä»»æ„å¸³æˆ¶
```

---

## è³‡æ–™çµæ§‹ï¼ˆGoogle Sheetsï¼‰

### 6 å¼µ Sheet

| Sheet | ç”¨é€” |
|-------|------|
| `Category` | Living ç§‘ç›®ï¼ˆé£²é£Ÿã€äº¤é€š...ï¼‰ |
| `Sub_Tag` | ç§‘ç›®å­é¡žï¼ˆæ—©é¤ã€åˆé¤...ï¼‰ |
| `Saving_Goal` | å„²è“„ç›®æ¨™æ¸…å–® |
| `Transaction` | æ‰€æœ‰äº¤æ˜“è¨˜éŒ„ |
| `Settlement_Log` | çµç®—è¨˜éŒ„ |
| `Config` | ç³»çµ±è¨­å®š |

### Transaction Type

| Type | èªªæ˜Ž |
|------|------|
| `Income` | æ”¶å…¥ |
| `Expense` | Living æ—¥å¸¸æ”¯å‡º |
| `Allocate` | æœˆåˆæ¡†å®š |
| `Saving_In` | å„²è“„ç›®æ¨™ç´¯ç© |
| `Saving_Complete` | å„²è“„ç›®æ¨™å®Œæˆæ”¯å‡º |
| `Investing_Confirm` | æŠ•è³‡ç¢ºèªæ’¥æ¬¾ |
| `Settlement_In` | çµç®—çµé¤˜é€² Free Fund |
| `Settlement_Out` | çµç®—è¶…æ”¯æ‰£ Back Up |
| `Transfer` | å¸³æˆ¶é–“è½‰å¸³ |

---

## UI æž¶æ§‹

```
Tab 1: ðŸ“ è¨˜å¸³ï¼ˆé è¨­ï¼Œæœ€é«˜é »ï¼‰
â”œâ”€â”€ ç‹€æ…‹ç¸½è¦½ï¼ˆBack Up è¡€é‡ã€Free Fundã€ä»Šæ—¥å¯ç”¨é¡åº¦ã€ç§‘ç›®é€²åº¦ï¼‰
â”œâ”€â”€ å¿«é€Ÿè¨˜å¸³è¡¨å–®
â””â”€â”€ æœ¬æœŸæ¶ˆè²»ç´€éŒ„

Tab 2: ðŸŽ¯ ç›®æ¨™ï¼ˆæ¬¡é«˜é »ï¼‰
â”œâ”€â”€ æŠ•è³‡ç´¯ç©å¡ç‰‡ï¼ˆç½®é ‚ï¼‰
â”œâ”€â”€ é€²è¡Œä¸­çš„å„²è“„ç›®æ¨™
â””â”€â”€ å·²å®Œæˆç›®æ¨™

Tab 3: ðŸ§­ ç­–ç•¥ï¼ˆä½Žé »ï¼Œæ¯æœˆä¸€æ¬¡ï¼‰
â”œâ”€â”€ å¾…è™•ç†çµç®—
â”œâ”€â”€ æ”¶å…¥ / Living / Saving / Investing / Back Up å€å¡Š
â”œâ”€â”€ æ¡†å®šç¸½è¦½
â”œâ”€â”€ å¸³æˆ¶è½‰å¸³
â”œâ”€â”€ ç³»çµ±è¨­å®š
â””â”€â”€ è³‡æ–™åŒ¯å‡º
```

---

## é–‹ç™¼è¦ç¯„

### æª”æ¡ˆçµæ§‹

```
Budget_Level_v2/
â”œâ”€â”€ CLAUDE.md
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ PRD_v2.0.md
â”‚   â””â”€â”€ Development_Roadmap_v2.md
â”œâ”€â”€ .streamlit/
â”‚   â”œâ”€â”€ config.toml
â”‚   â””â”€â”€ secrets.toml
â”œâ”€â”€ requirements.txt
â””â”€â”€ app.py
```

### å‘½åæ…£ä¾‹

- å‡½å¼ï¼š`snake_case`ï¼ˆä¾‹ï¼š`get_living_remaining()`ï¼‰
- å¸¸æ•¸ï¼š`UPPER_SNAKE_CASE`ï¼ˆä¾‹ï¼š`ACCOUNT_LIVING`ï¼‰
- é¡žåˆ¥ï¼š`PascalCase`ï¼ˆè‹¥æœ‰ï¼‰

### å¿«å–ç­–ç•¥

| è³‡æ–™ | è£é£¾å™¨ | TTL |
|------|--------|-----|
| Google Sheets é€£ç·š | `@st.cache_resource` | æ°¸ä¹… |
| è³‡æ–™è¼‰å…¥ | `@st.cache_data` | 60 ç§’ |
| å¯«å…¥å¾Œ | `st.cache_data.clear()` + `st.rerun()` | â€” |

### éŒ¯èª¤è™•ç†

- æ‰€æœ‰ Google Sheets æ“ä½œéœ€ try-except
- ä½¿ç”¨ `st.error()` é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
- ä½¿ç”¨ `st.toast()` é¡¯ç¤ºæˆåŠŸè¨Šæ¯

---

## æ–‡ä»¶ä½ç½®

| æ–‡ä»¶ | è·¯å¾‘ | ç”¨é€” |
|------|------|------|
| PRD | `docs/PRD_v2.0.md` | å®Œæ•´ç”¢å“è¦æ ¼ |
| Roadmap | `docs/Development_Roadmap_v2.md` | é–‹ç™¼ä»»å‹™èˆ‡ Prompt |

**é–‹ç™¼æ™‚è«‹å…ˆè®€å–é€™å…©ä»½æ–‡ä»¶ï¼Œç¢ºä¿ç†è§£å®Œæ•´éœ€æ±‚ã€‚**

---

## é–‹ç™¼éšŽæ®µ

| Phase | å…§å®¹ | ç‹€æ…‹ |
|-------|------|------|
| 1 | è³‡æ–™ç®¡é“èˆ‡åŸºç¤Žè¨˜å¸³ | å¾…é–‹å§‹ |
| 2 | é¤˜é¡è¨ˆç®—èˆ‡å„€è¡¨æ¿ | â€” |
| 3 | å„²è“„ç›®æ¨™ | â€” |
| 4 | çµç®—èˆ‡ç­–ç•¥ | â€” |
| 5 | å„ªåŒ–èˆ‡æ”¶å°¾ | â€” |

---

## é—œéµå…¬å¼

### ä»Šæ—¥å¯ç”¨é¡åº¦

```python
daily_available = living_remaining / days_left_in_period
```

### Living å‰©é¤˜

```python
living_remaining = sum(Allocate to Living) - sum(Expense from Living)
# è‹¥ç„¡ Allocateï¼Œä½¿ç”¨ Category budgets åŠ ç¸½ä½œç‚º fallback
```

### Back Up é¤˜é¡

```python
back_up = (
    Config['Back_Up_Initial']
    + sum(Allocate to Back_Up)
    - sum(Settlement_Out)
    + sum(Transfer to Back_Up)
    - sum(Transfer from Back_Up)
)
```

### Free Fund é¤˜é¡

```python
free_fund = (
    Config['Free_Fund_Initial']
    + sum(Settlement_In)
    + sum(Transfer to Free_Fund)
    - sum(Transfer from Free_Fund)
)
```

---

## PoC éšŽæ®µä¸åš

- å°å¸³æ ¡æ­£
- é€±çµç®—ï¼ˆåªæœ‰æœˆçµç®—ï¼‰
- æŠ•è³‡ç¸¾æ•ˆè¿½è¹¤
- ä¿®æ”¹æ­·å²äº¤æ˜“
- æŽ¨æ’­é€šçŸ¥

---

## é–‹å§‹é–‹ç™¼

1. ç¢ºèª Google Sheets å·²å»ºç«‹ä¸¦åˆ†äº«çµ¦ Service Account
2. ç¢ºèª `.streamlit/secrets.toml` å·²è¨­å®š
3. è®€å– `docs/Development_Roadmap_v2.md` ä¸­å°æ‡‰ Phase çš„ Prompt
4. é–‹å§‹å¯¦ä½œ

**æœ‰å•é¡Œæ™‚ï¼Œå„ªå…ˆæŸ¥é–± `docs/PRD_v2.0.md` ä¸­çš„è©³ç´°å®šç¾©ã€‚**
